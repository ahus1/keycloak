<#import "/templates/guide.adoc" as tmpl>
<#import "/templates/kc.adoc" as kc>
<#import "/templates/options.adoc" as opts>
<#import "/templates/links.adoc" as links>

<@tmpl.guide
title="Enabling {project_name} Event Metrics"
summary="Learn how to enable and use {project_name} Event Metrics"
includedOptions="metrics-enabled">

== Enable event metrics

- To enable the event listener via the GUI interface, go to
. Click *Realm settings* in the menu.
. Click the *Events* tab.
. The *Event Listeners* configuration should have an entry named `micrometer-metrics`.

- To enable the event listener via the Keycloak CLI, such as when building a Docker container, use these commands.

* Linux:
+
[options="nowrap"]
----
$ kcadm.sh update events/config -r demorealm -s 'eventsListeners+=["micrometer-metrics"]'
----
* Windows:
+
[options="nowrap"]
----
c:\> kcadm update events/config -r demorealm -s "eventsListeners+=[\"micrometer-metrics\"]"
----

The snippet below is an example of a response:

[source]
----

# TYPE keycloak_admin_event_delete counter
# HELP keycloak_admin_event_delete
keycloak_admin_event_delete_total{realm="master",resource="CLIENT"} 1.0
# TYPE keycloak_admin_event_create counter
# HELP keycloak_admin_event_create
keycloak_admin_event_create_total{realm="master",resource="CLIENT"} 1.0
# TYPE keycloak_event_refresh_token counter
# HELP keycloak_event_refresh_token
keycloak_event_refresh_token_total{client_id="security-admin-console",provider="keycloak",realm="master"} 1.0
# TYPE keycloak_event_login_error counter
# HELP keycloak_event_login_error
keycloak_event_login_error_total{client_id="security-admin-console",error="user_not_found",provider="keycloak",realm="master"} 1.0
# TYPE keycloak_event_login_attempt counter
# HELP keycloak_event_login_attempt
keycloak_event_login_attempt_total{client_id="security-admin-console",provider="keycloak",realm="master"} 2.0
# TYPE keycloak_event_code_to_token counter
# HELP keycloak_event_code_to_token
keycloak_event_code_to_token_total{client_id="security-admin-console",provider="keycloak",realm="master"} 1.0
# TYPE keycloak_event_login counter
# HELP keycloak_event_login
keycloak_event_login_total{client_id="security-admin-console",provider="keycloak",realm="master"} 1.0
# TYPE keycloak_event_logout counter
# HELP keycloak_event_logout
keycloak_event_logout_total{realm="master"} 1.0
...
----


</@tmpl.guide>
